---
title: "Muscle Bundle Force Testing Data Analysis"
author: "Jeremy Morowitz"
date: "10/01/2021"
output: 
  html_document:
    toc: true 
    toc_float: 
      collapsed: false 
      smooth_scroll: false 
---
![](/users/jeremymorowitz/Desktop/Bundle.jpeg)![](/users/jeremymorowitz/Desktop/Bundle.jpeg)![](/users/jeremymorowitz/Desktop/Bundle.jpeg)![](/users/jeremymorowitz/Desktop/Bundle.jpeg)
![](/users/jeremymorowitz/Desktop/Force_Test.jpg)

## Muscle Bundle Force Testing
Contractile force is a functional measure of muscle bundles that are cultured in 3D. We would like to increase the number of stem cells in this tissue in order to facilitate muscle repair *in vivo*. We predict that over-expression of Notch ligand DLL1 will help in this aim. Here, we investigate the impact of a *MHCK7:DLL1* virus on bundles' ability to generate force at various stretch lengths and stimulated by various frequencies, as compared to *MHCK7:mCherry* control bundles. Additionally, bundles were either grown entirely in "Growth Media" or changed to "Differentiation Media" on day 4 of culture, adding another layer to this experiment. We hypothesize that "Growth Media" will lead to decreased forces compared to "Differentiation Media", but are hoping that the *MHCK7:DLL1* virus group in "Differentiation Media" generates normal forces relative to the control group of *MHCK7:mCherry* in "Differentiation Media".  


### Load Libraries / Import Data 
```{r echo=FALSE, message=FALSE}
library(readxl)
library(tidyverse)
library(tidybiology)
library(dplyr)
library(ggplot2)
library(viridis)
library(ggsignif)
library(knitr)
library(ggpubr)
```
This is what our force testing data looks like:
```{r}
Data <- read_excel("/Users/jeremymorowitz/Desktop/results.xlsx")
glimpse(Data)
```

### Calculate Active Force / Refine Data
Active force is calculated by subtracting "Max Force" from "Baseline Force".
```{r warning=FALSE}
Active_Force <- Data %>% 
  mutate('Active Force' =  Data$`Max Force`-Data$`Baseline Force`)
glimpse(Active_Force)
```
In order to assess our question of the impact of virus condition on active force we want to whittle down the variables in our data set.  
```{r warning=FALSE}
Interest <- Active_Force %>% 
  select('Group','Active Force')
glimpse(Interest)
```

### First Glance
Now we need to distill these 104 observations into 4 groups, one for each virus and media condition condition. The "Active Force", in units of mN, is quickly calculated here by taking the maximum force generated, out of all of the observations, for each group. 
```{r warning=FALSE}
Max_Force <- Interest %>% 
  group_by(Group) %>% 
  summarize(Max = max(`Active Force`))
kable(Max_Force, caption = "Maximum Active Force")
```

### Visualization of Maximum Force
```{r warning=FALSE, echo=FALSE}
ggplot(Max_Force) +
  aes(x = Max_Force$Group,
      y = Max_Force$Max) +
  geom_point(color="black", size=5) +
  labs(
    x = "Group",
    y = "Max Force (mN)",
    title = "Max Force by Group")
```

It is evident that the mCherry control in "Differentiation Media" generates a stronger maximum force than the DLL1 group in "Differentiation Media". The maximum force generated by the DLL1 group in "Differentiation Media" is more similar to the maximum forces generated by control bundles cultured entirely in "Growth Media".  

### More Insight is Needed
Although max force is an interesting starting point, this entirely discounts several other factors, such as biological replicates, stretch length, and frequency of stimulation.  

Let's first look at active force per group, at 1 Hz, for various stretch lengths.  

To start we need to manipulate our data to highlight this information.
```{r warning=FALSE}
OneHz_Force <- Active_Force %>% 
  select("Name","Group","Stretch","Hertz","Active Force") %>% 
  filter(Hertz == 1)
glimpse(OneHz_Force)
```

Now we can visualize the data, only assessing 1 Hz stimulation, while faceting the various stretch values, relative to bundle length.   

```{r warning=FALSE, echo=FALSE}
ggplot(OneHz_Force) +
  aes(x = OneHz_Force$Group,
      y = OneHz_Force$`Active Force`,
      color = OneHz_Force$Group) +
  geom_boxplot() +
  geom_point() +
  geom_signif(comparisons = list(c("DLL1Diff", "mCherryDiff")),
                             map_signif_level = FALSE, textsize = 2, test="t.test") +
  facet_wrap(~OneHz_Force$Stretch) +
  scale_color_viridis(discrete = TRUE) +
  labs(
    x = "Group",
    y = "Active Force (mN)",
    title = "Active Force by Stretch Percentage (%) at 1 Hz") +
  theme(axis.text.x = element_text(angle = 10))
```

### Highest Active Force Stretch?
The average active force at stretches of 5%, 10%, and 15% all look fairly similar. What are the actual values and how do they compare? A compressed graph will make this trend easier to understand.  

```{r warning=FALSE, echo=FALSE}
OneHz_By_Stretch <- OneHz_Force %>% 
  select("Group","Active Force","Stretch")
  
ggplot(OneHz_By_Stretch) +
  aes(x = OneHz_By_Stretch$Stretch,
      y = OneHz_By_Stretch$`Active Force`,
      color = Group, shape = Group) +
  geom_point(size = 3) + 
   scale_color_viridis(discrete = TRUE) +
  labs(
    x = "Stretch (%)",
    y = "Active Force (mN)",
    title = "Impact of Stretch (%) on Active Force (mN) at 1 Hz")
```

15% stretch generates, on average, the highest active forces. This can be confirmed with a table of averages.
```{r warning=FALSE}
Stretch_Average <- OneHz_By_Stretch %>%
  group_by(Stretch) %>% 
  summarize("Average Active Force (nM)" = mean(`Active Force`))
kable(Stretch_Average, caption = "Average Active Force by Stretch %")
```

### 15% Stretch
Filtering the data further to only include active forces at a stretch of 15%, and a stimulation of 1 Hz, will further refine the observations.
```{r warning=FALSE}
Stretch_15 <- OneHz_By_Stretch %>% 
  filter(Stretch == 15)
Average_Active_15 <- Stretch_15 %>% 
  group_by(Group) %>% 
  summarize("Average Active Force" = mean(`Active Force`))
kable(Average_Active_15, caption = "Average Active Force at 15% Stretch")
```

### Assessing Functional Significance
These data are the most informative in answering our question; 15% stretch generates the highest active forces, and 1 Hz is the most functionally relevant stimulation frequency. Is the difference between virus groups significant?  

```{r warning=FALSE, echo=FALSE}
ggplot(Stretch_15) +
  aes(x = Stretch_15$Group,
      y = Stretch_15$`Active Force`) +
  geom_boxplot() + 
  geom_point(color = "red", size = 3) +
  labs(
    x = "Group",
    y = "Active Force (mN)",
    title = "Active Force (mN) at 15% Stretch and 1 Hz") +
  geom_signif(comparisons = list(c("DLL1Diff", "mCherryDiff")),
                             map_signif_level = FALSE, textsize = 3, test="t.test") 
```

A p-value of 0.00081 indicates that there is a statistically significant difference between the forces generated by control bundles and the bundles exposed to the *MHCK7:DLL1* virus.  

### Passive Force
Beyond active force, how do virus and media conditions impact passive force? Passive force is the difference between the baseline force value at a stretch of 15% and a stretch of 0%. In order to calculate passive force, first we need to average the measurements of baseline force for each group at a stretch of 15 and 0, and subsequently subtract the former from the latter. 
```{r warning=FALSE, echo=FALSE, message=FALSE}
Passive <- Data %>% 
  select("Group","Stretch","Baseline Force")
Passive$Stretch <- as.integer(Passive$Stretch)
Filtered <- Passive %>% 
  filter(Stretch == 0 | Stretch == 15) %>% 
  group_by(Group,Stretch)

DLL1G_0 <- Filtered %>% 
  filter(Group == "DLL1Growth",Stretch == 0) %>% 
  group_by(Group,Stretch) %>% 
  summarize(DLL1G_Passive = mean(`Baseline Force`))
DLL1G_15 <- Filtered %>% 
  filter(Group == "DLL1Growth",Stretch == 15) %>% 
  group_by(Group,Stretch) %>% 
  summarize(DLL1Growth = mean(`Baseline Force`))
DLL1Growth <- DLL1G_15[3] - DLL1G_0[3]
DLL1D_0 <- Filtered %>% 
  filter(Group == "DLL1Diff",Stretch == 0) %>% 
  group_by(Group,Stretch) %>% 
  summarize(DLL1D_Passive = mean(`Baseline Force`))
DLL1D_15 <- Filtered %>% 
  filter(Group == "DLL1Diff",Stretch == 15) %>% 
  group_by(Group,Stretch) %>% 
  summarize(DLL1Diff = mean(`Baseline Force`))
DLL1Diff <- DLL1D_15[3] - DLL1D_0[3]
mCherryG_0 <- Filtered %>% 
  filter(Group == "mCherryGrowth",Stretch == 0) %>% 
  group_by(Group,Stretch) %>% 
  summarize(mCherryG_Passive = mean(`Baseline Force`))
mCherryG_15 <- Filtered %>% 
  filter(Group == "mCherryGrowth",Stretch == 15) %>% 
  group_by(Group,Stretch) %>% 
  summarize(mCherryGrowth = mean(`Baseline Force`))
mCherryGrowth <- mCherryG_15[3] - mCherryG_0[3]
mCherryD_0 <- Filtered %>% 
  filter(Group == "mCherryDiff",Stretch == 0) %>% 
  group_by(Group,Stretch) %>% 
  summarize(mCherryD_Passive = mean(`Baseline Force`))
mCherryD_15 <- Filtered %>% 
  filter(Group == "mCherryDiff",Stretch == 15) %>% 
  group_by(Group,Stretch) %>% 
  summarize(mCherryDiff = mean(`Baseline Force`))
mCherryDiff <- mCherryD_15[3] - mCherryD_0[3]

Aggregated_Passive_Force <- t(data.frame(DLL1Diff,DLL1Growth,mCherryDiff,mCherryGrowth)) %>% 
  bind_cols(c("DLL1Diff","DLL1Growth","mCherryDiff","mCherryGrowth"))

Aggregated_Passive_Force <- tibble(Group = c("DLL1Diff","DLL1Growth","mCherryDiff","mCherryGrowth"),
                                     `Passive Force` = c(DLL1Diff[[1]],DLL1Growth[[1]],mCherryDiff[[1]],mCherryGrowth[[1]]))
```

### Visualization of Passive Force
```{r warning=FALSE, echo=FALSE}
ggplot(Aggregated_Passive_Force) +
  aes(x = Group,
      y = Aggregated_Passive_Force$`Passive Force`) +
  geom_point(color = "blue", size = 5) +
  ylim(0,5) +
  labs(
    x = "Group",
    y = "Passive Force (mN)",
    title = "15% Stretch Passive Force by Group")
```

Notably, the average passive force shows a totally different trend, with the mCherryDiff group as the lowest and the DLL1Growth group as the highest. This can be confirmed in a table. 
```{r echo=FALSE}
kable(Aggregated_Passive_Force, caption = "Average 15% Stretch Passive Force by Group")
```

### Active and Passive Forces
Therefore, it would be interesting to combine the data for average active force at 15% stretch and 1 Hz stimulation and 15% stretch passive force for each group in order to understand this trend. 
```{r warning=FALSE, message=FALSE}
Combined_Forces <- full_join(Average_Active_15, Aggregated_Passive_Force)
kable(Combined_Forces, caption = "Average Active and 15% Stretch Passive Forces Combined")
```

```{r warning=FALSE,echo=FALSE}
colors <- c("Average Active Force" = "red", "15% Stretch Passive Force" = "blue")

ggplot(Combined_Forces, aes(x = Group)) +
  geom_point(aes(y = `Average Active Force`, color = "Average Active Force"), size = 5) + 
   geom_point(aes(y = `Passive Force`, color = "15% Stretch Passive Force"), size = 5) +
  ylim(0,5) +
  labs(
    x = "Group",
    y = "Force (mN)",
    title = "Comparison of Average Active Force and 15% Passive Passive Force by Group",
    color = "Force Type") +
    scale_color_manual(values = colors)
```

There are clear differences. Is 15% stretch passive force inversely correlated with average active force at 15% stretch and 1 Hz stimulation? 

```{r echo=FALSE, warning=FALSE}

ggplot(Combined_Forces, aes(x = Combined_Forces$`Passive Force`,
                            y = Combined_Forces$`Average Active Force`)) +
  geom_point(size = 5, color = "purple") +
  ylim(0,5) +
  xlim(0,5) +
  labs(
    x = "15% Stretch Passive Force (mN)",
    y = "Average Active Force (mN)",
    title = "Correlation of Average Active Force and 15% Stretch Passive Force")
```

With equal axis values, there is not a very convincing correlation between active and passive force. What is the R^2^ value?  

```{r echo=FALSE, warning=FALSE, message=FALSE}

ggplot(Combined_Forces, aes(x = Combined_Forces$`Passive Force`,
                            y = Combined_Forces$`Average Active Force`)) +
  geom_point(size = 5, color = "purple") +
  ylim(0,5) +
  xlim(0.9,1.5) +
  labs(
    x = "15% Stretch Passive Force (mN)",
    y = "Average Active Force (mN)",
    title = "Correlation of Average Active Force and 15% Stretch Passive Force") + 
  geom_smooth(method = "lm", se=FALSE) +
  stat_regline_equation(label.y = 3.5, label.x = 1.3, aes(label = ..rr.label..))
```

With altered axis values, the correlation looks more substantial. However, the R^2^ value is only 0.52. There is a trend between active and passive force, but it will certainly need more investigation before any conclusions can be made.  


## Conclusion
Unfortunately, the incorporation of the *MHCK7:DLL1* virus into primary human muscle bundles significantly decreases the generation of active force at a stretch of 15% when stimulated at 1 Hz, as compared to control bundles. Additionally, the relationship between passive force and active force is interesting, but difficult to make any claims off of.  

### Prioritized Follow-Up
A new gene target, or other method of increasing stem cell populations, should be pursued in order to achieve tissue with enhanced regenerative capacity without sacrificing functionality, as assessed by active force generation. It would also be worthwhile to further investigate the relationship between passive force and active force. 

### Acknowledgements
I would like to thank the authors of tidyverse and tidybiology, Dr. Matt Hirschey for teaching this class, as well as Akshay Bareja for his assistance with this project. 